"use strict";function _classCallCheck(c,a){if(!(c instanceof a))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,a){for(var b,c=0;c<a.length;c++)b=a[c],b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(e,b.key,b)}function _createClass(d,a,b){return a&&_defineProperties(d.prototype,a),b&&_defineProperties(d,b),d}var a11yMenubar=function(){function i(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:d;_classCallCheck(this,i),this._keyCode={TAB:9,ENTER:13,ESC:27,SPACE:32,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40},this._id=a,this._domObj=b,this._hoverintent=d,this._ariaLabel=c,this._navElem=this._domObj.getElementById(this._id),this._menubarMenuitems=[],this._currentMenubarIndex=0,this._currentMenuitem=null,this._navElem.setAttribute("aria-label",this._ariaLabel),this._navElem.classList.add("a11y-menubar");var e=this._navElem.querySelector("ul");(e.setAttribute("role","menubar"),e.setAttribute("aria-label",this._ariaLabel),this._hoverintent)?this._hoverintent(e,function(){},this.handleMouseoutMenubar.bind(this)).options({timeout:900,interval:50}):e.addEventListener("mouseout",this.handleMouseoutMenubar.bind(this));for(var f,g=e.children,h=0;h<g.length;h++)f=g[h].firstElementChild,f.classList.add("a11y-menubar-menuitem"),this._menubarMenuitems[h]=f,f.addEventListener("keydown",this.handleKeydownMenubar.bind(this));for(var j=this._navElem.querySelectorAll("a + ul > li > a"),k=0;k<j.length;k++)j[k].addEventListener("keydown",this.handleKeydownSubmenu.bind(this));for(var l=e.querySelectorAll("li > a"),m=0;m<l.length;m++){l[m].setAttribute("role","menuitem"),l[m].setAttribute("tabindex","-1");for(var n=l[m].parentNode,o=n.querySelectorAll("a + ul"),p=0;p<o.length;p++){var q=o[p].parentNode,r=q.querySelector("a"),s=r.textContent;r.setAttribute("aria-haspopup","true"),r.setAttribute("aria-expanded","false"),o[p].setAttribute("role","menu"),o[p].setAttribute("aria-label",s),o[p].classList.add("a11y-menubar-menu-closed")}this._hoverintent?this._hoverintent(l[m],this.handleMouseoverMenuitem.bind(this),function(){}).options({timeout:100,interval:0}):l[m].addEventListener("mouseover",this.handleMouseoverMenuitem.bind(this))}for(var t=e.querySelectorAll("li"),u=0;u<t.length;u++)t[u].setAttribute("role","none");this._menubarMenuitems[0].setAttribute("tabindex","0"),this._currentMenuitem=this._menubarMenuitems[0]}return _createClass(i,[{key:"destroy",value:function(){}},{key:"handleKeydownMenubar",value:function(i){if(!i.defaultPrevented){var a=!1,b=i.target,c=this.normalizeKey(i.key||i.keyCode);if(c==this._keyCode.SPACE||c==this._keyCode.ENTER||c==this._keyCode.ARROW_DOWN){this.closeAllSubmenus(),this.openSubmenu(b);var d=b.parentNode.querySelector("ul[role=menu] > li > a[role=menuitem]");null!=d&&(d.focus(),this.updateCurrentMenuitem(d)),a=!0}else if(c==this._keyCode.ARROW_RIGHT){var j=this._currentMenubarIndex+1>=this._menubarMenuitems.length?0:this._currentMenubarIndex+1,e=this._menubarMenuitems[j];e.focus(),this._currentMenubarIndex=j,this.updateCurrentMenuitem(e),a=!0}else if(c==this._keyCode.ARROW_LEFT){var f=0>this._currentMenubarIndex-1?this._menubarMenuitems.length-1:this._currentMenubarIndex-1,g=this._menubarMenuitems[f];g.focus(),this._currentMenubarIndex=f,this.updateCurrentMenuitem(g),a=!0}else if(c==this._keyCode.ARROW_UP){this.openSubmenu(b);var h=b.parentNode.querySelector("ul[role=menu]").lastElementChild.firstElementChild;h.focus(),this.updateCurrentMenuitem(h),a=!0}else if(c==this._keyCode.HOME){var k=this._menubarMenuitems[0];k.focus(),this.updateCurrentMenuitem(k),a=!0}else if(c==this._keyCode.END){var l=this._menubarMenuitems[this._menubarMenuitems.length-1];l.focus(),this.updateCurrentMenuitem(l),a=!0}else;a&&(i.stopPropagation(),i.preventDefault())}}},{key:"handleKeydownSubmenu",value:function(m){if(!m.defaultPrevented){var a=!1,b=m.target,c=this.normalizeKey(m.key||m.keyCode);if(c==this._keyCode.SPACE||c==this._keyCode.ENTER)b.click(),a=!0;else if(c==this._keyCode.ESC){var d=b.parentNode.parentNode.parentNode.querySelector("a[role=menuitem]");this.closeSubmenu(d),d.focus(),this.updateCurrentMenuitem(d),a=!0}else if(c==this._keyCode.ARROW_RIGHT){if(this.hasSubmenu(b)){var n=b.parentNode.querySelector("a + ul").querySelector("li > a");this.openSubmenu(b),n.focus(),this.updateCurrentMenuitem(n)}else{this.closeAllSubmenus();var o=this._currentMenubarIndex+1>=this._menubarMenuitems.length?0:this._currentMenubarIndex+1,e=this._menubarMenuitems[o];e.focus(),this.openSubmenu(e),this._currentMenubarIndex=o,this.updateCurrentMenuitem(e)}a=!0}else if(c==this._keyCode.ARROW_LEFT){var f=b.parentNode.parentNode.parentNode.querySelector("a[role=menuitem]");if(this.closeSubmenu(f),f.focus(),this.updateCurrentMenuitem(f),this._currentMenuitem.classList.contains("a11y-menubar-menuitem")){var p=0>this._currentMenubarIndex-1?this._menubarMenuitems.length-1:this._currentMenubarIndex-1,g=this._menubarMenuitems[p];g.focus(),this.openSubmenu(g),this._currentMenubarIndex=p,this.updateCurrentMenuitem(g)}a=!0}else if(c==this._keyCode.ARROW_DOWN){var h,i=b.parentNode.nextElementSibling;h=null==i?b.parentNode.parentNode.firstElementChild.querySelector("a"):i.querySelector("a"),h.focus(),this.updateCurrentMenuitem(h),a=!0}else if(c==this._keyCode.ARROW_UP){var j,k=b.parentNode.previousElementSibling;j=null==k?b.parentNode.parentNode.lastElementChild.querySelector("a"):k.querySelector("a"),j.focus(),this.updateCurrentMenuitem(j),a=!0}else if(c==this._keyCode.HOME){var l=b.parentNode.parentNode.firstElementChild.querySelector("a");l.focus(),this.updateCurrentMenuitem(l),a=!0}else if(c==this._keyCode.END){var q=b.parentNode.parentNode.lastElementChild.querySelector("a");q.focus(),this.updateCurrentMenuitem(q),a=!0}else;a&&(m.stopPropagation(),m.preventDefault())}}},{key:"handleMouseoverMenuitem",value:function(c){if(!c.defaultPrevented){var a=c.target;this.hasSubmenu(a)&&this.openSubmenu(a),this.closeSiblingSubmenus(a)}}},{key:"handleMouseoutMenubar",value:function(b){b.defaultPrevented||(b.target,this.closeAllSubmenus())}},{key:"updateCurrentMenuitem",value:function(b){this._currentMenuitem.setAttribute("tabindex","-1"),this._currentMenuitem=b,this._currentMenuitem.setAttribute("tabindex","0")}},{key:"hasSubmenu",value:function(d){var a=d.parentNode,b=a.querySelector("a + ul");return null!=b}},{key:"openSubmenu",value:function(d){var a=d.parentNode,b=a.querySelector("ul");null!=b&&(b.classList.remove("a11y-menubar-menu-closed"),b.classList.add("a11y-menubar-menu-open"),d.setAttribute("aria-expanded","true"))}},{key:"closeSubmenu",value:function(d){var a=d.parentNode,b=a.querySelector("ul");null!=b&&(b.classList.remove("a11y-menubar-menu-open"),b.classList.add("a11y-menubar-menu-closed"),d.setAttribute("aria-expanded","false"))}},{key:"closeSiblingSubmenus",value:function(f){for(var a=f.parentNode.parentNode,b=a.querySelectorAll("li > a[role=menuitem]"),c=[],d=0;d<b.length;d++)b[d]!==f&&c.push(b[d]);for(var e=0;e<c.length;e++)this.closeSubmenu(c[e])}},{key:"closeAllSubmenus",value:function(){for(var d,a=this._navElem.querySelectorAll("ul.a11y-menubar-menu-open"),b=0;b<a.length;b++)d=a[b].parentNode.querySelector("a"),d.setAttribute("aria-expanded","false"),a[b].classList.remove("a11y-menubar-menu-open"),a[b].classList.add("a11y-menubar-menu-closed")}},{key:"normalizeKey",value:function(c){var a=null;switch(c){case"Tab":case 9:a=this._keyCode.TAB;break;case"Enter":case 13:a=this._keyCode.ENTER;break;case"Escape":case"Esc":case 13:a=this._keyCode.ESC;break;case" ":case 32:a=this._keyCode.SPACE;break;case"End":case 35:a=this._keyCode.END;case"Home":case 36:a=this._keyCode.HOME;break;case"ArrowLeft":case 37:a=this._keyCode.ARROW_LEFT;break;case"ArrowUp":case 38:a=this._keyCode.ARROW_UP;break;case"ArrowRight":case 39:a=this._keyCode.ARROW_RIGHT;break;case"ArrowDown":case 40:a=this._keyCode.ARROW_DOWN;}return a}}]),i}();
//# sourceMappingURL=a11yMenubar.js.map
